version: "3.9"
services:
  mqtt:
    image: eclipse-mosquitto:2
    container_name: ids-mqtt
    ports:
      - "1883:1883"

  backend:
    build: ./backend
    container_name: ids-backend
    env_file:
      - .env
    environment:
      - MODEL_PATH=/app/ml/models/model.joblib
    volumes:
      - .:/app
    ports:
      - "8000:8000"
    command: uvicorn backend.app.main:app --host 0.0.0.0 --port 8000 --reload
    depends_on:
      - mqtt

  dashboard:
    build: ./dashboard
    container_name: ids-dashboard
    environment:
      - VITE_BACKEND_HOST=localhost:8000
    volumes:
      - ./dashboard:/app
      - /app/node_modules
    ports:
      - "5173:5173"
    command: npm run dev -- --host 0.0.0.0 --port 5173
    depends_on:
      - backend
